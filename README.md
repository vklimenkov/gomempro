# gomempro
Расширение пакета github.com/bradfitz/gomemcache/memcache, позволяет помещать в мемкеш структуры
## Предыстория
Работая с языком Perl, я привык, что там можно помещать в мемкеш структуру любой сложности (массив, хеш с многими подуровнями и т.д.). И затем получить её обратно в том же виде, даже не задумываясь о скрытых под капотом механизмах. Ну а если копнуть глубже, можно и чуть поковырять этот механизм: выбрать или  написать свой сериализатор, позволяющий, к примеру, дополнительно сжимать данные.

Поэтому, я был удивлён, что аналогичный пакет для **go** позволяет помещать в мемкеш только строки (вернее, массивы байтов). И я написал небольшое расширение, дополняющее пакет memcached методами для работы с объектами (структурами произвольного типа).

Не смотря на простоту, тут используются многие фишки go: и встраивание структуры, и горутины с каналами, и работа с пустым интерфейсом.
## Пример использования

```
// подключаемся к мемкешу. синтаксис полностью аналогичен пакету memcache
mc := mempro.New("127.0.0.1:11211")

// тестовая структура
type Ex struct {
    Num int
    Str string
}
x := Ex{Num: 123, Str: "abc"}

// помещаем в мемкеш
err := mc.SetStruct("key_one", x)

// то же самое, только задаём ещё время жизни - 5 минут
err := mc.SetStruct("key_one", x, 5*60)

// вытаскиваем из мемкеша
var y Ex
err = mc.GetStruct("key_one", &y)
fmt.Println(y) // {123 abc}

// мультигет
var z Ex
var w SomeOtherType // структуры могут быть разные в одном мультигете

// понадобится карта, ключами которой будут имена ключей мемкеша
// а значениями - пустые структуры, которые будут заполнены данными
list := make(map[string]any)
list["key_one"] = &z
list["key_two"] = &w 

// передаём карту в метод GetMultiStruct, который заполнит поля структур данными
err = mc.GetMultiStruct(list)
fmt.Println(list["key_one"]) // &{123 abc}
// если хотим получить не ссылку на структуру, а её саму, тогда так:
v, ok := list["key_one"].(*Ex)
fmt.Println(*v) // {123 abc}

// также можно пользоваться всеми методами memcache:
new_val, err := mc.Increment("key_three", 1)
 ```
## Лицензия
Свободное распространение
